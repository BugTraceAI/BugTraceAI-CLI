# Plan 01-01: TUI Foundation & Structure

## Frontmatter

```yaml
wave: 1
depends_on: []
files_modified:
  - bugtrace/core/ui/tui/__init__.py
  - bugtrace/core/ui/tui/app.py
  - bugtrace/core/ui/tui/styles.tcss
  - bugtrace/core/ui/tui/screens/__init__.py
  - bugtrace/core/ui/tui/screens/main.py
  - bugtrace/core/ui/tui/screens/loader.py
  - bugtrace/core/ui/tui/widgets/__init__.py
  - bugtrace/core/ui/tui/widgets/header.py
  - bugtrace/core/ui/tui/widgets/footer.py
  - bugtrace/cli/main.py
autonomous: true
```

## Objective

Establish the Textual application skeleton with CSS grid layout, entry point, and basic screens.

## Context

- **Source spec:** `.ai-context/planning/TASK_001_FOUNDATION.md`
- **Legacy file:** `bugtrace/core/ui.py` (1,673 lines, Rich-based)
- **Target:** Textual TUI with OpenCode-like UX

## Tasks

<task id="1" name="Create directory structure">
Create the TUI module structure:

```
bugtrace/core/ui/tui/
├── __init__.py
├── app.py
├── styles.tcss
├── screens/
│   ├── __init__.py
│   ├── main.py
│   └── loader.py
└── widgets/
    ├── __init__.py
    ├── header.py
    └── footer.py
```

All `__init__.py` files should export their module's public classes.
</task>

<task id="2" name="Implement global stylesheet" depends_on="1">
Create `styles.tcss` with:

1. Screen layout using CSS Grid (3 rows: header 3, content 1fr, footer 1)
2. Color scheme matching current dark theme (surface, primary colors)
3. Layout classes: `.layout-header`, `.layout-content`, `.layout-footer`
4. Panel styling with borders matching Rich ROUNDED box

Reference the current theme colors from `ui.py` lines 91-100 (logo gradient colors).
</task>

<task id="3" name="Implement BugTraceApp class" depends_on="2">
Create `app.py` with:

```python
from textual.app import App, ComposeResult
from textual.binding import Binding
from .screens.main import MainScreen

class BugTraceApp(App):
    CSS_PATH = "styles.tcss"
    TITLE = "BugTraceAI Reactor"

    BINDINGS = [
        Binding("q", "quit", "Quit"),
        Binding("d", "toggle_dark", "Toggle Dark"),
    ]

    def on_mount(self) -> None:
        self.push_screen(MainScreen())
```

Include proper async lifecycle methods and clean shutdown handling.
</task>

<task id="4" name="Implement MainScreen" depends_on="3">
Create `screens/main.py` with placeholder containers:

```python
from textual.screen import Screen
from textual.containers import Grid, Container
from textual.widgets import Static

class MainScreen(Screen):
    def compose(self) -> ComposeResult:
        yield Header(show_clock=True)
        yield Container(
            Static("[Phase Pipeline Placeholder]", id="pipeline"),
            Grid(
                Static("[Activity Graph]", id="activity"),
                Static("[System Metrics]", id="metrics"),
                id="metrics-row"
            ),
            Static("[Agent Swarm Placeholder]", id="swarm"),
            id="main-content"
        )
        yield Footer()
```

Use Textual's built-in Header and Footer initially.
</task>

<task id="5" name="Implement LoaderScreen" depends_on="3">
Create `screens/loader.py` with:

1. BugTraceAI ASCII logo (copy from `ui.py` lines 94-100)
2. Gradient coloring on the logo
3. "Initializing..." message with spinner
4. Auto-transition to MainScreen after load

This screen shows during app startup.
</task>

<task id="6" name="Add CLI entry point" depends_on="4">
Modify `bugtrace/cli/main.py` to add `--tui` flag:

1. Import BugTraceApp from the new module
2. Add `--tui` argument to argparse
3. When `--tui` is passed, run `BugTraceApp().run()` instead of legacy Dashboard
4. Ensure clean exit on CTRL+C
</task>

<task id="7" name="Test and verify" depends_on="6">
Verify acceptance criteria:

1. `python -m bugtrace --tui` launches full-screen app
2. Header shows "BugTraceAI Reactor" and clock
3. Footer shows keybindings
4. Terminal resize adjusts layout automatically
5. CTRL+C exits cleanly without terminal corruption
6. `q` key exits cleanly
</task>

## Verification Criteria

- [ ] Directory structure exists at `bugtrace/core/ui/tui/`
- [ ] `styles.tcss` defines grid layout with 3 rows
- [ ] `BugTraceApp` class loads MainScreen on mount
- [ ] `MainScreen` renders placeholder panels
- [ ] `--tui` flag works from CLI
- [ ] App resizes gracefully
- [ ] Clean exit on CTRL+C and `q`

## Must-Haves (Goal-Backward)

The foundation must enable:
1. **Widget composition** - Screens must use `compose()` pattern for widget porting (Phase 2)
2. **CSS-driven layout** - No hardcoded dimensions in Python (for responsive design)
3. **Message passing** - App must support `post_message()` for async wiring (Phase 3)
4. **Clean lifecycle** - Proper startup/shutdown for worker integration (Phase 3)
