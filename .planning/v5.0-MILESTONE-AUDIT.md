---
milestone: v5.0
audited: 2026-02-05T08:30:00Z
status: gaps_found
scores:
  phases: 3/3
  integration: 14/15
  flows: 4/5
gaps:
  integration:
    - "EventBus VULNERABILITY_DETECTED events not routed to TUI"
tech_debt:
  - phase: 01-foundation
    items:
      - "DEFERRED: App resizes gracefully (needs human verification)"
  - phase: 03-interactions
    items:
      - "WARNING: Stale 'Coming in Phase 3' message in main.py (cosmetic)"
      - "PLACEHOLDER: /export command not implemented"
      - "PLACEHOLDER: /pause and /resume not implemented"
---

# Milestone v5.0 Audit Report

**Milestone:** v5.0 - Textual TUI Migration
**Audited:** 2026-02-05T08:30:00Z
**Status:** GAPS FOUND

## Executive Summary

All 3 phases completed and verified. However, integration testing revealed a **critical gap**: real scan findings do not flow to the TUI because the EventBus → Conductor → TUI chain is incomplete.

**Recommendation:** Create a gap closure plan to wire EventBus events to the TUI.

---

## Phase Verification Summary

| Phase | Name | Status | Score |
|-------|------|--------|-------|
| 01 | Foundation & Structure | PASSED | 4/4 |
| 02 | Widget Migration & Async Engine | PASSED | 7/7 |
| 03 | High-Fidelity Interaction | PASSED | 5/5 |

**Total:** 3/3 phases verified

---

## Integration Check Results

### Connected Exports (14/15)

| Export | From | Used By | Status |
|--------|------|---------|--------|
| BugTraceApp | app.py | __main__.py | ✓ |
| MainScreen | screens/main.py | app.py, loader.py | ✓ |
| LoaderScreen | screens/loader.py | app.py | ✓ |
| FindingsTable | widgets/findings_table.py | app.py, main.py | ✓ |
| LogInspector | widgets/log_inspector.py | app.py, main.py | ✓ |
| CommandInput | widgets/command_input.py | app.py, main.py | ✓ |
| FindingDetailsModal | screens/modals/ | app.py | ✓ |
| UICallback | workers.py | app.py | ✓ |
| Messages (7 types) | messages.py | app.py, workers.py | ✓ |
| PipelineStatus | widgets/pipeline.py | main.py, app.py | ✓ |
| AgentSwarm | widgets/swarm.py | main.py, app.py | ✓ |
| SystemMetrics | widgets/metrics.py | main.py, app.py | ✓ |
| ActivityGraph | widgets/activity.py | main.py, app.py | ✓ |
| conductor | conductor.py | app.py, team.py | ✓ |

### Message Handler Chain (Complete)

```
Pipeline Event           →  App Handler              →  Widget Method
AgentUpdate              →  on_agent_update()        →  AgentSwarm.update_agent()
PipelineProgress         →  on_pipeline_progress()   →  PipelineStatus.phase/progress
NewFinding               →  on_new_finding()         →  FindingsTable.add_finding()
PayloadTested            →  on_payload_tested()      →  PayloadFeed.add_payload()
LogEntry                 →  on_log_entry()           →  LogInspector.log()
MetricsUpdate            →  on_metrics_update()      →  SystemMetrics, ActivityGraph
ScanComplete             →  on_scan_complete()       →  app.notify()
```

---

## Critical Gap Found

### EventBus → TUI Findings Not Wired

**Severity:** CRITICAL
**Impact:** FindingsTable stays empty during real scans

**Analysis:**

The pipeline uses EventBus for inter-agent communication:
- Specialists emit `VULNERABILITY_DETECTED` via `self.emit_finding()` (base.py:294)
- ReportingAgent subscribes to collect findings (reporting.py:71-74)

However, **nothing bridges** EventBus events to `conductor.notify_finding()`:

```python
# This method exists in conductor.py but is NEVER CALLED:
def notify_finding(self, finding_type, details, severity, param=None, payload=None, **kwargs):
    if self.ui_callback:
        self.ui_callback.on_finding(...)  # Would update TUI
```

**Result:**
1. UICallback is registered via `conductor.set_ui_callback(callback)`
2. Specialists find vulnerabilities and emit VULNERABILITY_DETECTED
3. Events go to ReportingAgent and logs
4. **TUI never receives NewFinding messages**
5. FindingsTable stays empty

**Fix Required:**
Add an event subscriber in TeamOrchestrator or app.py that:
```python
def on_vulnerability_detected(self, event):
    conductor.notify_finding(
        finding_type=event.finding_type,
        details=event.details,
        severity=event.severity,
        ...
    )
```

---

## E2E Flow Verification

| Flow | Status | Notes |
|------|--------|-------|
| Launch TUI (--tui) | ✓ COMPLETE | CLI → App → LoaderScreen → MainScreen |
| Demo Mode (--demo) | ✓ COMPLETE | Skips loader, widgets show animated data |
| Click Finding → Modal | ✓ COMPLETE | RowSelected → push_screen(Modal) |
| Command Input | ✓ COMPLETE | /help, /filter, /stop work |
| **Real Scan → Findings** | ✗ BROKEN | EventBus gap (see above) |

**Flows:** 4/5 complete

---

## Tech Debt Summary

### Phase 01: Foundation
- DEFERRED: "App resizes gracefully" needs human verification

### Phase 03: Interactions
- WARNING: Stale "Coming in Phase 3" message in main.py (cosmetic)
- PLACEHOLDER: /export command not implemented
- PLACEHOLDER: /pause and /resume commands not implemented

**Total:** 4 items (1 warning, 3 placeholders)

---

## Widget Composition Verified

All widgets present in MainScreen.compose() with correct IDs:

| Widget | ID | Present |
|--------|-----|---------|
| PipelineStatus | #pipeline | ✓ |
| ActivityGraph | #activity | ✓ |
| SystemMetrics | #metrics | ✓ |
| AgentSwarm | #swarm | ✓ |
| FindingsTable | #findings-table | ✓ |
| PayloadFeed | #payload-feed | ✓ |
| LogInspector | #log-inspector | ✓ |
| FindingsSummary | #findings | ✓ (hidden) |
| LogPanel | #logs | ✓ (hidden) |
| CommandInput | #command-input | ✓ |

---

## Recommendations

1. **Immediate (Blocker):** Wire EventBus VULNERABILITY_DETECTED to conductor.notify_finding()
2. **Low Priority:** Implement /export, /pause, /resume commands
3. **Cosmetic:** Update "Coming in Phase 3" message

---

_Audited by: Claude (gsd-integration-checker)_
_Report: .planning/v5.0-MILESTONE-AUDIT.md_
